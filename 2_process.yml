target_default: 2_process

include:
  - 1_fetch.yml

packages:
  - sf
  - dplyr
  - fasterize
  - snow

file_extensions:
  - feather
  - ind

sources:
  - 2_process/src/choose_timesteps.R
  - 2_process/src/extract_storm_line.R
  - 2_process/src/process_precip.R
  - 2_process/src/extract_storm_points.R
  - 2_process/src/interpolate_storm_points.R


targets:

  2_process:
    depends:
      - 2_process/out/storm_line.rds.ind
      - 2_process/out/storm_points_interp.rds.ind

  2_process/out/timesteps.rds.ind:
    command: choose_timesteps(target_name, dates)
  2_process/out/timesteps.rds:
    command: gd_get('2_process/out/timesteps.rds.ind')

  2_process/out/storm_line.rds.ind:
    command: extract_storm_line(
      ind_file=target_name, storm_shp_ind='1_fetch/out/storm_track.zip.ind', cfg=view_config)
  2_process/out/storm_line.rds:
    command: gd_get('2_process/out/storm_line.rds.ind')

  2_process/out/precip_rasters.rds.ind:
    command: process_precip_rasters(ind_file = target_name,
      precip_spatial_ind='1_fetch/out/precip_spatial.rds.ind',
      precip_values_ind='1_fetch/out/precip_values.rds.ind',
      view_polygon = view_polygon,
      view_config = view_config)
  2_process/out/precip_rasters.rds:
    command: gd_get('2_process/out/precip_rasters.rds.ind')

  2_process/out/storm_points_coarse.rds.ind:
    command: extract_storm_points(
      ind_file=target_name, storm_shp_ind='1_fetch/out/storm_track.zip.ind', cfg=view_config)
  2_process/out/storm_points_coarse.rds:
    command: gd_get('2_process/out/storm_points_coarse.rds.ind')

  2_process/out/storm_points_interp.rds.ind:
    command: interpolate_storm_points(
      ind_file=target_name, timesteps_ind='2_process/out/timesteps.rds.ind',
      coarse_points_ind='2_process/out/storm_points_coarse.rds.ind')
  2_process/out/storm_points_interp.rds:
    command: gd_get('2_process/out/storm_points_interp.rds.ind')

