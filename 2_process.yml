target_default: 2_process

include:
  - 1_fetch.yml

packages:
  - dplyr
  - scipiper
  - sp

file_extensions:
  - feather
  - ind

sources:
  - 2_process/src/choose_timesteps.R
  - 2_process/src/process_site_locations_to_sp.R
  - 2_process/src/process_dv_stats.R

targets:

  2_process:
    depends:
      - 2_process/out/timesteps.rds.ind
      - 2_process/out/site_locations_sp.rds.ind
      - 2_process/out/dv_stats.rds.ind

  # -- config --
  proj_str:
    command: viz_config[[I('projection')]]

  2_process/out/timesteps.rds.ind:
    command: choose_timesteps(target_name, dates = dates)
  2_process/out/timesteps.rds:
    command: gd_get('2_process/out/timesteps.rds.ind')

  2_process/out/site_locations_sp.rds.ind:
    command: process_site_locations_to_sp(
      ind_file = target_name,
      site_locations_ind = '1_fetch/out/site_locations.rds.ind')
  2_process/out/site_locations_sp.rds:
    command: gd_get('2_process/out/site_locations_sp.rds.ind')

  2_process/out/dv_stats.rds.ind:
    command: process_dv_stats(
      ind_file = target_name,
      dv_data_ind = '1_fetch/out/dv_data.rds.ind',
      site_stats_ind = '1_fetch/out/site_stats.rds.ind',
      dates = dates,
      percentiles = percentiles)
  2_process/out/dv_stats.rds:
    command: gd_get('2_process/out/dv_stats.rds.ind')
