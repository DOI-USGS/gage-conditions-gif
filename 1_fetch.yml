target_default: 1_fetch

packages:
  - dataRetrieval
  - yaml
  - httr
  - sf
  - sp
  - mapdata
  - maps
  - ncdf4
  - arrayhelpers
  - geoknife
  - dplyr
  - xml2
  - jsonlite

file_extensions:
  - ind

sources:
  - 1_fetch/src/map_utils.R

targets:

  1_fetch:
    depends:
      - 1_fetch/out/all_sites.rds.ind

  # -- read config --
  viz_config:
    command: yaml.load_file('viz_config.yml')
  dates:
    command: viz_config[[I('dates')]]
  projection:
    command: viz_config[[I('projection')]]

  # -- get sites and site info --
  
  # See https://www.census.gov/geo/maps-data/data/cbf/cbf_state.html for details on this file.
  1_fetch/in/pre_state_boundaries_census.zip:
    command: download.file(destfile = target_name, url = I("http://www2.census.gov/geo/tiger/GENZ2017/shp/cb_2017_us_state_20m.zip"), method = I("libcurl"))

  # -- get streamdata --
