target_default: 6_visualize

include:
  - 2_process.yml

packages:

file_extensions:
  - feather
  - ind

sources:
  - 6_visualize/src/create_gif_tasks.R
  - 6_visualize/src/create_gif_makefile.R

targets:

  6_visualize:
    depends:
      - 6_gif_tasks.yml

  # create_storm_frame will soon be called for all frames from within
  # a task table. just calling it once here to illustrate
  storm_frame_config:
    command: viz_config[I(c('bbox','projection','width','height','focus_geoms','secondary_geoms'))]

  # tmp=temporary folder for holding files to only be created on 1 computer.
  # out=folder to hold .ind and data files corresponding to shared cache or everybody's local build.
  # log=folder for the few indicator files that don't correspond to a data file.
  6_visualize/tmp:
    command: dir.create(target_name, recursive=I(TRUE), showWarnings=I(FALSE))
  6_visualize/log:
    command: dir.create(target_name, recursive=I(TRUE), showWarnings=I(FALSE))
  visualize_folders:
    command: list(
      tmp='6_visualize/tmp',
      log='6_visualize/log')

  gif_tasks:
    command: create_gif_tasks(
      timestep_ind = '2_process/out/timesteps.rds.ind',
      folders = visualize_folders,
      storm_line_ind='2_process/out/storm_line.rds.ind',
      storm_points_ind='2_process/out/storm_points_interp.rds.ind',
      precip_rasters_ind='2_process/out/precip_rasters.rds.ind',
      stream_data_ind='1_fetch/out/streamdata.rds.ind',
      cfg = storm_frame_config)

  6_gif_tasks.yml:
    command: create_gif_makefile(
      makefile = target_name,
      task_plan = gif_tasks,
      remake_file = I('6_visualize.yml'))
